<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Xem ƒë∆°n h√†ng</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2 {
      color: #0077cc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    input, select {
      padding: 5px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h2>üîé Xem ƒë∆°n h√†ng theo th·ªùi gian v√† b√†n</h2>

  <label for="tableFilter">L·ªçc theo b√†n:</label>
  <select id="tableFilter">
    <option value="">T·∫•t c·∫£</option>
  </select>

  <label for="timeFilter">L·ªçc theo gi·ªù (HH:MM):</label>
  <input type="time" id="timeFilter">
  <button onclick="filterOrders()">L·ªçc</button>

  <table id="orderTable">
    <thead>
      <tr>
        <th>Th·ªùi gian</th>
        <th>S·ªë b√†n</th>
        <th>T√™n m√≥n</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Ghi ch√∫</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/1OdhpqkC5PqVZPmTuDrnAVGL_xcKJVNgQXLQd6hKAJMs/gviz/tq?tqx=out:json';

    let allData = [];

    function loadOrders() {
      fetch(sheetURL)
        .then(res => res.text())
        .then(text => {
          const json = JSON.parse(text.substr(47).slice(0, -2));
          const rows = json.table.rows;

          allData = rows.map(r => ({
            time: r.c[0]?.f || '',
            table: r.c[1]?.v || '',
            food: r.c[2]?.v || '',
            quantity: r.c[3]?.v || '',
            note: r.c[4]?.v || ''
          }));

          fillTable(allData);
          populateTableFilter(allData);
        });
    }

    function fillTable(data) {
      const tbody = document.querySelector('#orderTable tbody');
      tbody.innerHTML = '';
      data.forEach(row => {
        tbody.innerHTML += `
          <tr>
            <td>${row.time}</td>
            <td>${row.table}</td>
            <td>${row.food}</td>
            <td>${row.quantity}</td>
            <td>${row.note}</td>
          </tr>
        `;
      });
    }

    function populateTableFilter(data) {
      const select = document.getElementById('tableFilter');
      const uniqueTables = [...new Set(data.map(row => row.table))];
      uniqueTables.forEach(table => {
        const option = document.createElement('option');
        option.value = table;
        option.textContent = `B√†n ${table}`;
        select.appendChild(option);
      });
    }

    function filterOrders() {
      const tableValue = document.getElementById('tableFilter').value;
      const timeValue = document.getElementById('timeFilter').value;

      const filtered = allData.filter(row => {
        const matchTable = tableValue === '' || row.table == tableValue;
        const matchTime = timeValue === '' || row.time.startsWith(timeValue);
        return matchTable && matchTime;
      });

      fillTable(filtered);
    }

    loadOrders();
  </script>
</body>
</html>
